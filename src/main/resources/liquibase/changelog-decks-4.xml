<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="decks-4" author="hstafford">
        <comment>
            Update the decks table to hold the set it belongs to.
        </comment>

        <!-- 1. Add new columns -->
        <addColumn tableName="decks">
            <column name="set" type="INT"/>
        </addColumn>

        <!-- 2. Drop old unique constraint on "name" -->
        <dropUniqueConstraint tableName="decks" constraintName="decks_name_unique"/>

        <!-- 3. Add new composite unique constraint on ("set", "name") -->
        <addUniqueConstraint
                tableName="decks"
                columnNames="set, name"
                constraintName="sets_decks_name_unique"/>

        <!-- 4. Add a new foreign key constraint on sets' "id" -->
        <addForeignKeyConstraint
                baseTableName="decks"
                baseColumnNames="set"
                referencedTableName="sets"
                referencedColumnNames="id"
                constraintName="decks_sets_fk"
                onDelete="CASCADE"/>
    </changeSet>

</databaseChangeLog>